mixin userInfo(user)
    .hostInfo.media
        .media-body
            .media-left(style='float:left;width:25%;margin-right:15px')!= f.img(f.resPath(c, 'portrait/' + user._id + '.jpg'))
            .media-heading
                strong!= f.link(user, 'username')
                    small(style='float:right')
                        if user.title
                            span=user.title
                        if user.industry
                            span &nbsp;-&nbsp;
                            if i18.iCat('industry')
                                span= i18.iCat('industry')[user.industry]
            != user.introduction

mixin panel(title,cls)
    if !attributes.class
        -attributes.class='panel-default ' + cls
    .panel&attributes(attributes)
        .panel-heading
            h3.panel-title= title
        if block
            block

mixin mobBtn(id,icon)
    button#menuBtn.navbar-toggle(type='button',data-toggle='collapse',data-target=id)
        if icon
            != f.icon(icon)
        else
            span.icon-bar
            span.icon-bar
            span.icon-bar

mixin nav(nav)
    ul&attributes(attributes)
        li
            a(href='/') 首页
        each it in nav
            if it.children && it.children.length > 0
                li
                    a(href=it.href)= it.label
                        span.caret
                    ul.dropdown-menu
                        each item in it.children
                            li
                                a(href='#{item.href}')= item.label
            else
                li
                    a(href='#{it.href}')= it.label
mixin itemList(items, title)
    if items
        +panel(title)
            .list-group
                +media(items,{})


mixin media(posts,opt)
    if !opt
        -opt={}
        
    if !opt.ttLimits
        -opt.ttLimits= 12

    if !opt.ctLimit
        -opt.ctLimit= 24

    if !opt.headKey
        -opt.headKey= 'head'

    if !opt.text
        -opt.text= 'brief'

    if !attributes.class
        -attributes.class = 'media_left list-group-item'

    if !attributes.target
        -attributes.target = '_blank'

    each it in posts
        -attributes.href = '/'+it._e+'/'+it._id
        a&attributes(attributes)
            .row
                if opt.oneCol
                    != f.imgItem(it, c, opt.headKey)
                else
                    .col-xs-4.col-md-3.pr0
                        != f.imgItem(it, c, opt.headKey)
                .col-xs-8.col-md-9
                    if block
                        block
                    else
                        h4.media-heading!=it.title || it.username
                        .small
                            if it.author
                                | #{it.author.username}
                            if it.pubTime
                                | 发表于 #{it.pubTime.pattern()}
                        != f.dStr(it.text, opt.ctLimit)
        //brief || it.description || it.address

mixin avatars(users)
    .avatars
        each it in users
            a(href= '/user/' + it._id title= it.username)&attributes(attributes)
                +userPic(it)

mixin userPic(u)
    != f.img(f.resPath(c, 'portrait/' + u._id + '.jpg'))


mixin comments(id,entity,cs,cls)
    if !cls
        -cls = 'panel panel-default comments'
    +panel('家人的评论')(class=cls)
        .newOne
            a.btn.btn-sm.btn-primary(onclick="cf._comment('#{id}','#{entity}')")
                != f.icon('pencil')
                | 写评论
        if cs
            each it in  cs
                .media
                    if it.user
                        div(class='col-xs-2')
                            +userPic(it.user)
                    div(class='col-xs-10')
                        if block
                            block
                        else
                            h4.media-heading!= it.user.username
                            small.pull-right!= f.icon('thumbs-up', 'a', it.up || 0)
                            p!= it.content
                            p!= it.createdDate

